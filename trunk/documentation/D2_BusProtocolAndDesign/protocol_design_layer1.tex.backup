\subsection{physical layer access}
\label{sec:bus:design:layer1}

The physical layer in the ``ES2011'' configuration is provided by a one-wire-USART terminated with a pull-down resistor, 
leading us to the fact, of a dominant 0 and an recessive 1 level.\\

Since this must not be true for all possible configuratoins supported by the protocol this leads
us to the first physical layer description. To accomplish support for other configurations the physical 
layer provided here has to be adjusted or completely exchanged by specific implementations.\\


\begin{figure}[h]
 \label{sec:bus:design:layer1:usartconfig}

\begin{center}


\definecolor{bgblue}{rgb}{0.41961,0.80784,0.80784}%
\definecolor{bgred}{rgb}{1,0.61569,0.61569}%
\definecolor{fgblue}{rgb}{0,0,0.6}%
\definecolor{fgred}{rgb}{0.6,0,0}%
%
\begin{tikztimingtable}[
    %timing/slope=0,         % no slope
    timing/coldist=2pt,     % column distance
    timing/lslope=0.1,
    xscale=2.05,yscale=2., % scale diagrams
    semithick               % set line width
  ]
  \scriptsize timing  	& 11{C}                              \\
  \scriptsize data                     & .5H L{S} 8D{8Bit} H       \\
  %R                     & [fgblue]  UH .8U 1.4H 0.8L \\
  %MISO & D{z} 2D{z} \\
  %Q                     &          L .8H 1.7L 1.5H LL       \\
  %$\overline{\mbox{Q}}$ &          H .8L 1.7H 1.5L HH       \\
  %Q                     & [fgred]  HLHHHLL                  \\
  %$\overline{\mbox{Q}}$ & [fgred]  LHLLLHH                  \\
\extracode
 \makeatletter
  \begin{pgfonlayer}{background}
%   % Draw shaded backgrounds
%   \shade [right color=bgblue,left color=white]
%      (7,-8.45) rectangle (-2,-4.6);
%   \shade [right color=bgred,left color=white]
%      (7,-12.8) rectangle (-2,-8.6);
  % Add background grid lines
  \begin{scope}[gray,semitransparent,semithick]
    \horlines{}
    \foreach \x in {1,...,10}
      \draw (\x,1) -- (\x,-2); %-12.8
    % similar: \vertlines{1,...,6}
  \end{scope}
  % Add labels
%   \node [anchor=south east,inner sep=0pt]
%     at (7,-8.45) {\tiny clocked};
%   \node [anchor=south east,inner sep=0pt,fgred]
%     at (7,-12.8) {\tiny positive edge triggered};
 \end{pgfonlayer}
\end{tikztimingtable}%

\end{center}

\caption{Timing of 8N1 USART Config.}
\end{figure}

For data transmission we use a USART configuration with 1 start-bit, 8 data bits, 1 stop bit and no parity, as depicted in Figure \ref{sec:bus:design:layer1:usartconfig}.
The physical layer as defined in our protocol has to support collission avoidance strategies of higher layers, and thus provide mechanisms for bitwise arbitration as described below.\\

To provide bit wise arbitration we need to access the bus in the startup-phase of a message in a modified soft-usart.
After the bus is assigned to certain node the communication over the hardware supported usart can be established, since this decreases the processor load immensely.


\begin{figure}[h]
 \label{sec:bus:design:layer1:arbitration}

\begin{center}


\definecolor{bgblue}{rgb}{0.41961,0.80784,0.80784}%
\definecolor{bgred}{rgb}{1,0.61569,0.61569}%
\definecolor{fgblue}{rgb}{0,0,0.6}%
\definecolor{fgred}{rgb}{0.6,0,0}%
%
\begin{tikztimingtable}[
    %timing/slope=0,         % no slope
    timing/coldist=2pt,     % column distance
    timing/lslope=0.1,
    xscale=2.05,yscale=2., % scale diagrams
    semithick               % set line width
  ]
  \scriptsize node1  	& HLHHHLHHLHHLLLLH  \\
  \scriptsize node2     & HLHHHLHHLHHLHHHH  \\
  \scriptsize bus       & HLHHHLHHLHHLLLLH  \\
  %R                     & [fgblue]  UH .8U 1.4H 0.8L \\
  %MISO & D{z} 2D{z} \\
  %Q                     &          L .8H 1.7L 1.5H LL       \\
  %$\overline{\mbox{Q}}$ &          H .8L 1.7H 1.5L HH       \\
  %Q                     & [fgred]  HLHHHLL                  \\
  %$\overline{\mbox{Q}}$ & [fgred]  LHLLLHH                  \\
\extracode
 \makeatletter
  \begin{pgfonlayer}{background}
%   % Draw shaded backgrounds
%   \shade [right color=bgblue,left color=white]
%      (7,-8.45) rectangle (-2,-4.6);
%   \shade [right color=bgred,left color=white]
%      (7,-12.8) rectangle (-2,-8.6);
  % Add background grid lines
  \begin{scope}[gray,semitransparent,semithick]
    \horlines{}
    \foreach \x in {1,...,15}
      \draw (\x,1) -- (\x,-4); %-12.8
    % similar: \vertlines{1,...,6}
  \end{scope}
  % Add labels
   \node [anchor=south east,inner sep=0pt]
     at (14.5,-2.5) {\tiny collission detected};
%   \node [anchor=south east,inner sep=0pt,fgred]
%     at (7,-12.8) {\tiny positive edge triggered};
 \end{pgfonlayer}
\end{tikztimingtable}%

\end{center}

\caption{Collission avoidance via arbitration.}
\end{figure}
